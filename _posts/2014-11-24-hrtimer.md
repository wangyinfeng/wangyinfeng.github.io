---
layout: post
title: dynamic timer and power management
category: linux
---
In my opinion, the weakness of current mobile devices is not it's looking nor it's functions, it's the battery. It's worth to do some investigate about the power management.

On Linux, the power management is implemented by the `dynamic timer subsystem`, and `cpuidle subsystemï¼Ÿ`.

#dynamic timer
At the begining`when?`, the OS do the schedule by the fixed ticks, for i386, 100Hz first and then changed to 1000Hz`various depends on the processor arch`, the pros of fixed ticks is **simple**, there is a timer interrupt registered to the OS, and each time the tick comes, the timer interupt is happened, and something`updating timer, decrementing the currently running process's timeslice, expiring timers` can be done at that moment. The ticks is fixed, so the user can rely on the tick. The cons is it's always has tradeoff to select the **right** tick interval, too long lower the accuracy; too short waste the processor timer to handle the timer interrupt, and make the processor wake up 100/1000 times every second, the processor cannot go into deep sleep, eating battery.

##How to configure the ticks
The ticks is decided by the kernel macro `CONFIG_HZ`, the value is configured when doing kernel make, and setted when kernel boot up.  

```sh  
[root@localhost ~]# cat /usr/src/linux-3.12.1/include/asm-generic/param.h    
#ifndef __ASM_GENERIC_PARAM_H
#define __ASM_GENERIC_PARAM_H

#include <uapi/asm-generic/param.h>

# undef HZ
# define HZ             CONFIG_HZ       /* Internal kernel timer frequency */
# define USER_HZ        100             /* some user interfaces are */
# define CLOCKS_PER_SEC (USER_HZ)       /* in "ticks" like times() */
#endif /* __ASM_GENERIC_PARAM_H */

#cpuidle
```  

```sh  
[root@localhost ~]# cat /boot/config-`uname -r` | grep HZ
CONFIG_NO_HZ=y
# CONFIG_HZ_100 is not set
# CONFIG_HZ_250 is not set
# CONFIG_HZ_300 is not set
CONFIG_HZ_1000=y
CONFIG_HZ=1000
CONFIG_MACHZ_WDT=m
```  

##How to enbale tickless feature
Select the `CONFIG_NO_HZ=y` when do kconfig.

#TODO

#References
[What is a tickless kernel](http://www.quora.com/What-is-a-tickless-kernel)
